<header class="header" [class.scrolled]="isScrolled()">
  <nav class="nav container">
    <!-- Logo con animación mejorada -->
    <a routerLink="/" class="logo" (click)="closeMobileMenu()" aria-label="MathRisk Solution">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 100" class="logo-svg">
        <defs>
          <linearGradient id="grad_gray" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#4a4a4a;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#2c2c2c;stop-opacity:1" />
          </linearGradient>
        </defs>
        <path d="M10 90 L35 40 L60 90 L85 40 L110 90"
              fill="none"
              stroke="url(#grad_gray)"
              stroke-width="8"
              stroke-linecap="round"
              stroke-linejoin="round" />
        <circle cx="53" cy="34" r="4" fill="#87CEEB" />
        <circle cx="67" cy="34" r="4" fill="#87CEEB" />
        <circle cx="60" cy="25" r="4" fill="#87CEEB" />
      </svg>
      <span class="logo-text">MathRisk</span>
    </a>

    <!-- Toggle para menú móvil -->
    <button 
      class="mobile-menu-toggle" 
      (click)="toggleMobileMenu()"
      [attr.aria-expanded]="isMobileMenuOpen()"
      [attr.aria-label]="isMobileMenuOpen() ? 'Cerrar menú' : 'Abrir menú'">
      <span class="hamburger" [class.open]="isMobileMenuOpen()"></span>
    </button>

    <!-- Overlay para cerrar menú en móvil -->
    <div 
      class="mobile-overlay" 
      [class.active]="isMobileMenuOpen()"
      (click)="closeMobileMenu()"></div>

    <!-- Menú de navegación -->
    <ul class="nav-menu" [class.open]="isMobileMenuOpen()">
      <!-- Enlaces públicos - SIEMPRE visibles -->
      <li class="nav-item">
        <a 
          routerLink="/" 
          routerLinkActive="active" 
          [routerLinkActiveOptions]="{exact: true}" 
          (click)="closeMobileMenu()"
          class="nav-link">
          <span>Inicio</span>
        </a>
      </li>
      <li class="nav-item">
        <a 
          routerLink="/servicios" 
          routerLinkActive="active" 
          (click)="closeMobileMenu()"
          class="nav-link">
          <span>Servicios</span>
        </a>
      </li>
      <li class="nav-item">
        <a 
          routerLink="/cursos" 
          routerLinkActive="active" 
          (click)="closeMobileMenu()"
          class="nav-link">
          <span>Cursos</span>
        </a>
      </li>
      <li class="nav-item">
        <a 
          routerLink="/blog" 
          routerLinkActive="active" 
          (click)="closeMobileMenu()"
          class="nav-link">
          <span>Blog</span>
        </a>
      </li>

      <!-- Separador en móvil cuando hay usuario autenticado -->
      @if (isAuthenticated()) {
        <li class="nav-divider mobile-only"></li>
        
        <!-- Opciones de usuario autenticado en móvil -->
        <li class="nav-item mobile-only">
          <a 
            routerLink="/profile" 
            routerLinkActive="active" 
            (click)="closeMobileMenu()"
            class="nav-link">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Mi Perfil</span>
          </a>
        </li>
        <li class="nav-item mobile-only">
          <a 
            routerLink="/mis-cursos" 
            routerLinkActive="active" 
            (click)="closeMobileMenu()"
            class="nav-link">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            <span>Mis Cursos</span>
          </a>
        </li>
        <li class="nav-item mobile-only">
          <a 
            routerLink="/mis-certificados" 
            routerLinkActive="active" 
            (click)="closeMobileMenu()"
            class="nav-link">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            <span>Mis Certificados</span>
          </a>
        </li>

        <!-- Opciones de Admin en móvil -->
        @if (isAdmin()) {
          <li class="nav-divider mobile-only"></li>
          <li class="nav-item mobile-only">
            <a 
              routerLink="/admin" 
              routerLinkActive="active" 
              (click)="closeMobileMenu()"
              class="nav-link admin-link">
              <svg class="admin-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="3" x2="9" y2="21"></line>
              </svg>
              <span>Panel Admin</span>
            </a>
          </li>
        }

        <li class="nav-divider mobile-only"></li>
        <li class="nav-item mobile-only">
          <button 
            (click)="logout()"
            class="nav-link logout-link">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Cerrar Sesión</span>
          </button>
        </li>
      }

      <!-- Botón de Contacto solo en móvil cuando NO está autenticado -->
      @if (!isAuthenticated()) {
        <li class="nav-item nav-item-cta mobile-only">
          <a 
            routerLink="/contacto" 
            (click)="closeMobileMenu()"
            class="btn btn-primary">
            <span>Contacto</span>
            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </a>
        </li>
      }
    </ul>

    <!-- Botones de acción en Desktop -->
    <div class="desktop-actions">
      @if (!isAuthenticated()) {
        <!-- Usuario NO autenticado: mostrar solo Contacto -->
        <a routerLink="/contacto" class="btn btn-primary">
          <span>Contacto</span>
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      } @else {
        <!-- Usuario autenticado: mostrar avatar y menú -->
        <div class="user-menu-container">
          <button 
            class="user-avatar-button"
            (click)="toggleUserMenu()"
            [attr.aria-expanded]="isUserMenuOpen()"
            aria-label="Menú de usuario">
            <div class="user-avatar">
              {{ getInitials(userProfile()?.displayName) }}
            </div>
            @if (isAdmin()) {
              <span class="admin-badge">Admin</span>
            }
            <svg 
              class="dropdown-icon" 
              [class.open]="isUserMenuOpen()"
              width="16" 
              height="16" 
              viewBox="0 0 24 24" 
              fill="none" 
              stroke="currentColor" 
              stroke-width="2.5">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>

          <!-- Dropdown del usuario -->
          <div class="user-dropdown" [class.show]="isUserMenuOpen()">
            <div class="user-info">
              <div class="user-avatar-large">
                {{ getInitials(userProfile()?.displayName) }}
              </div>
              <div class="user-details">
                <p class="user-name">{{ userProfile()?.displayName }}</p>
                <p class="user-email">{{ userProfile()?.email }}</p>
                @if (isAdmin()) {
                  <span class="role-badge">Administrador</span>
                } @else {
                  <span class="role-badge user-role">Usuario</span>
                }
              </div>
            </div>

            <div class="dropdown-divider"></div>

            <ul class="dropdown-menu">
              @if (isAdmin()) {
                <li>
                  <a 
                    routerLink="/admin" 
                    (click)="closeUserMenu()"
                    class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="9" y1="3" x2="9" y2="21"></line>
                    </svg>
                    <span>Panel de Admin</span>
                  </a>
                </li>
                <li>
                  <a 
                    routerLink="/admin/blog" 
                    (click)="closeUserMenu()"
                    class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 20h9"></path>
                      <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                    <span>Gestionar Blog</span>
                  </a>
                </li>
                <li>
                  <a 
                    routerLink="/admin/cursos" 
                    (click)="closeUserMenu()"
                    class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    <span>Gestionar Cursos</span>
                  </a>
                </li>
                <li>
                  <a 
                    routerLink="/admin/certificados" 
                    (click)="closeUserMenu()"
                    class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <span>Certificados</span>
                  </a>
                </li>
                <div class="dropdown-divider"></div>
              }
              <li>
                <a 
                  routerLink="/profile" 
                  (click)="closeUserMenu()"
                  class="dropdown-item">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span>Mi Perfil</span>
                </a>
              </li>
              <li>
                <a 
                  routerLink="/mis-cursos" 
                  (click)="closeUserMenu()"
                  class="dropdown-item">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                  </svg>
                  <span>Mis Cursos</span>
                </a>
              </li>
              <li>
                <a 
                  routerLink="/mis-certificados" 
                  (click)="closeUserMenu()"
                  class="dropdown-item">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                  </svg>
                  <span>Mis Certificados</span>
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li>
                <button 
                  (click)="logout()"
                  class="dropdown-item logout-item">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  <span>Cerrar Sesión</span>
                </button>
              </li>
            </ul>
          </div>
        </div>
      }
    </div>
  </nav>
</header>