<div class="courses-management">
  <div class="management-header">
    <h2>Gestión de Cursos</h2>
    <button class="btn btn-primary" (click)="openCreateForm()" *ngIf="!showForm()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Nuevo Curso
    </button>
  </div>

  <!-- Course Form -->
  <div class="course-form-container" *ngIf="showForm()">
    <div class="form-header">
      <h3>{{ editingCourse() ? 'Editar Curso' : 'Crear Nuevo Curso' }}</h3>
      <button class="btn-close" (click)="cancelForm()">×</button>
    </div>

    <form [formGroup]="courseForm" (ngSubmit)="onSubmit()" class="course-form">
      <!-- Basic Information -->
      <section class="form-section">
        <h3>Información Básica</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label>Título del Curso *</label>
            <input type="text" formControlName="title" class="form-control">
          </div>

          <div class="form-group full-width">
            <label>Slug (URL)</label>
            <input type="text" formControlName="slug" class="form-control" readonly>
          </div>

          <div class="form-group full-width">
            <label>Descripción Corta *</label>
            <textarea formControlName="description" rows="2" class="form-control"></textarea>
          </div>

          <div class="form-group full-width">
            <label>Descripción Completa *</label>
            <textarea formControlName="longDescription" rows="5" class="form-control"></textarea>
          </div>

          <div class="form-group">
            <label>Categoría *</label>
            <input type="text" formControlName="category" class="form-control" placeholder="ej: Data Science, Finanzas">
          </div>

          <div class="form-group">
            <label>Tags (separados por coma)</label>
            <input type="text" formControlName="tags" class="form-control" placeholder="python, machine learning, riesgos">
          </div>

          <div class="form-group">
            <label>Nivel *</label>
            <select formControlName="level" class="form-control">
              <option value="Básico">Básico</option>
              <option value="Intermedio">Intermedio</option>
              <option value="Avanzado">Avanzado</option>
            </select>
          </div>

          <div class="form-group">
            <label>Estado *</label>
            <select formControlName="status" class="form-control">
              <option value="Programado">Programado</option>
              <option value="En curso">En curso</option>
              <option value="Finalizado">Finalizado</option>
            </select>
          </div>

          <div class="form-group">
            <label>Duración (horas) *</label>
            <input type="number" formControlName="duration" class="form-control" min="1">
          </div>

          <div class="form-group">
            <label>Máximo de Estudiantes *</label>
            <input type="number" formControlName="maxStudents" class="form-control" min="1">
          </div>

          <div class="form-group">
            <label>Fecha de Inicio *</label>
            <input type="date" formControlName="startDate" class="form-control">
          </div>

          <div class="form-group">
            <label>Fecha de Fin *</label>
            <input type="date" formControlName="endDate" class="form-control">
          </div>
        </div>

        <div class="form-checkboxes">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="active">
            <span>Curso Activo</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" formControlName="featured">
            <span>Curso Destacado</span>
          </label>
        </div>
      </section>

      <!-- Instructor Information -->
      <section class="form-section">
        <h3>Información del Instructor</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Nombre del Instructor *</label>
            <input type="text" formControlName="instructorName" class="form-control">
          </div>

          <div class="form-group">
            <label>Título/Cargo *</label>
            <input type="text" formControlName="instructorTitle" class="form-control" placeholder="ej: Senior Data Scientist">
          </div>

          <div class="form-group full-width">
            <label>URL Foto del Instructor *</label>
            <input type="url" formControlName="instructorPhoto" class="form-control" placeholder="https://example.com/photo.jpg">
          </div>
        </div>
      </section>

      <!-- Pricing -->
      <section class="form-section">
        <h3>Precios</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Precio Original *</label>
            <input type="number" formControlName="originalPrice" class="form-control" min="0" step="0.01">
          </div>

          <div class="form-group">
            <label>Precio con Descuento *</label>
            <input type="number" formControlName="discountedPrice" class="form-control" min="0" step="0.01">
          </div>
        </div>
      </section>

      <!-- Images -->
      <section class="form-section">
        <h3>Imágenes</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label>URL Imagen Destacada *</label>
            <input type="url" formControlName="featuredImage" class="form-control" placeholder="https://example.com/course-image.jpg">
          </div>

          <div class="form-group full-width">
            <label>URL Icono del Curso *</label>
            <input type="url" formControlName="icon" class="form-control" placeholder="https://example.com/icon.png">
          </div>
        </div>
      </section>

      <!-- What You Will Learn -->
      <section class="form-section">
        <div class="section-header">
          <h3>Lo que Aprenderás</h3>
          <button type="button" class="btn btn-secondary btn-sm" (click)="addWhatYouWillLearn()">
            + Agregar
          </button>
        </div>
        <div class="dynamic-list" formArrayName="whatYouWillLearn">
          <div class="list-item" *ngFor="let item of whatYouWillLearnArray.controls; let i = index">
            <input type="text" [formControlName]="i" class="form-control" placeholder="ej: Implementar modelos de machine learning">
            <button type="button" class="btn-remove" (click)="removeWhatYouWillLearn(i)">×</button>
          </div>
        </div>
      </section>

      <!-- Requirements -->
      <section class="form-section">
        <div class="section-header">
          <h3>Requisitos</h3>
          <button type="button" class="btn btn-secondary btn-sm" (click)="addRequirement()">
            + Agregar
          </button>
        </div>
        <div class="dynamic-list" formArrayName="requirements">
          <div class="list-item" *ngFor="let req of requirementsArray.controls; let i = index">
            <input type="text" [formControlName]="i" class="form-control" placeholder="ej: Conocimientos básicos de Python">
            <button type="button" class="btn-remove" (click)="removeRequirement(i)">×</button>
          </div>
        </div>
      </section>

      <!-- Syllabus -->
      <section class="form-section">
        <div class="section-header">
          <h3>Temario (Módulos)</h3>
          <button type="button" class="btn btn-secondary btn-sm" (click)="addModule()">
            + Agregar Módulo
          </button>
        </div>
        <div class="modules-list" formArrayName="syllabus">
          <div class="module-card" *ngFor="let module of syllabusArray.controls; let i = index" [formGroupName]="i">
            <div class="module-header-form">
              <h4>Módulo {{ i + 1 }}</h4>
              <button type="button" class="btn-remove" (click)="removeModule(i)">×</button>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>Título del Módulo *</label>
                <input type="text" formControlName="title" class="form-control">
              </div>
              <div class="form-group">
                <label>Duración (horas) *</label>
                <input type="number" formControlName="duration" class="form-control" min="1">
              </div>
            </div>

            <div class="topics-section">
              <div class="section-header-sm">
                <label>Temas</label>
                <button type="button" class="btn btn-secondary btn-sm" (click)="addTopic(i)">
                  + Tema
                </button>
              </div>
              <div class="dynamic-list" [formArrayName]="'topics'">
                <div class="list-item" *ngFor="let topic of getModuleTopics(i).controls; let j = index">
                  <input type="text" [formControlName]="j" class="form-control" placeholder="ej: Introducción a riesgos">
                  <button type="button" class="btn-remove" (click)="removeTopic(i, j)">×</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Launch Offer -->
      <section class="form-section">
        <h3>Oferta de Lanzamiento</h3>
        <label class="checkbox-label">
          <input type="checkbox" formControlName="launchOfferActive">
          <span>Activar Oferta de Lanzamiento</span>
        </label>
        
        <div class="form-grid" *ngIf="courseForm.get('launchOfferActive')?.value">
          <div class="form-group full-width">
            <label>Mensaje de la Oferta</label>
            <input type="text" formControlName="launchOfferMessage" class="form-control" 
                   placeholder="ej: ¡Últimos 5 cupos disponibles!">
          </div>
          <div class="form-group">
            <label>Cupos Disponibles</label>
            <input type="number" formControlName="launchOfferSeats" class="form-control" min="0">
          </div>
        </div>
      </section>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancelForm()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="!courseForm.valid">
          {{ editingCourse() ? 'Actualizar Curso' : 'Crear Curso' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Courses Table -->
  <div class="courses-table-container" *ngIf="!showForm()">
    <div class="loading-state" *ngIf="loading()">
      <div class="spinner"></div>
      <p>Cargando cursos...</p>
    </div>

    <div class="empty-state" *ngIf="!loading() && courses().length === 0">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
        <path d="M6 12v5c3 3 9 3 12 0v-5"/>
      </svg>
      <h3>No hay cursos registrados</h3>
      <p>Crea tu primer curso para comenzar</p>
    </div>

    <div class="table-responsive" *ngIf="!loading() && courses().length > 0">
      <table class="courses-table">
        <thead>
          <tr>
            <th>Curso</th>
            <th>Nivel</th>
            <th>Fecha Inicio</th>
            <th>Duración</th>
            <th>Inscritos</th>
            <th>Precio</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let course of courses()">
            <td>
              <div class="course-info">
                <img [src]="course.icon" [alt]="course.title" class="course-icon-sm">
                <div>
                  <strong>{{ course.title }}</strong>
                  <span class="course-category">{{ course.category }}</span>
                </div>
              </div>
            </td>
            <td>
              <span class="badge badge-level">{{ course.level }}</span>
            </td>
            <td>{{ formatDate(course.startDate) }}</td>
            <td>{{ course.duration }}h</td>
            <td>{{ course.enrolledStudents }} / {{ course.maxStudents }}</td>
            <td>
              <div class="price-cell">
                <span class="current-price">S/ {{ course.discountedPrice }}</span>
                <span class="original-price" *ngIf="course.discountPercentage > 0">
                  S/ {{ course.originalPrice }}
                </span>
              </div>
            </td>
            <td>
              <span class="status-badge" [ngClass]="{
                'status-active': course.active,
                'status-inactive': !course.active
              }">
                {{ course.active ? 'Activo' : 'Inactivo' }}
              </span>
              <span class="status-badge status-{{ course.status.toLowerCase() }}">
                {{ course.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-action btn-edit" (click)="editCourse(course)" title="Editar">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                </button>
                <button 
                  class="btn-action btn-deactivate" 
                  (click)="deactivateCourse(course)" 
                  *ngIf="course.active"
                  title="Desactivar">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                  </svg>
                </button>
                <button 
                  class="btn-action btn-delete" 
                  (click)="deleteCourse(course)"
                  title="Eliminar">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
